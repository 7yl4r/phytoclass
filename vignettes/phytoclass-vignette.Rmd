---
title: "The phytoclass package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{The phytoclass package}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(phytoclass)
```

# Introduction

The *phytoclass* package uses non-negative matrix factorization and simulated annealing to determine the biomass of different phytoplankton groups from pigment concentrations. The methodology is discussed in Hayward et al. (2023) and is similar to the CHEMTAX method of Mackey et al. (1996). 


For ease of use, most functions have default options. However the user also has the option to set their own parameters within the program, and instructions on how to do this are listed for each function. It is important to highlight that naming conventions for phytoplankton groups and their pigments should be adhered to when using the default samples. For example, the user should ensure that pigment names in their sample matrix (S) match the same pigment names in the pigment – Chl a ratio matrix (F).

At present the use of DV Chl a with Prochlorococcus is not supported, however this will be released in the future.

The functions covered here are:

1.	simulated_annealing
2.	Cluster
3.	Condition_test
4.	Steepest_Desc
5.	NNLS_MF

# simulated_annealing


This is the main function for the *phytoclass* package. 

It takes in the inputs (listed below) and returns the updated pigment to Chl a ratios, the Chl a biomass of each phytoplankton group, error associated with each group, and a graph displaying the Chl a concentration for each group.  

It is important that samples are clustered appropriately before using the function


Arguments:

**S** = Sample matrix – a matrix of pigment samples. Ensure that Chl a is the final column

**F** = Pigment to Chl a matrix. If left blank default values will be used. Ensure that pigment columns are in the same order as S and column naming conventions match. 

**user_defined_min_max** = If blank default values are used. To create different min_max values, follow the same structure as the phytoclass::min_max file. See example below. 

**do_matrix_checks** = this should only be set to true when using the default values. This will remove pigment columns that have column sums of 0. Set to FALSE if not using the default values.

**niter** = number of iterations – default is 500.

**step** = step ratio used. Default is 0.009. 

**weight.upper.bound** = the upper limit of the weights applied. The default value is 30. 


When using the default values, the only argument required is the sample matrix. However, make sure that the pigment names match those in the built-in pigment to Chl matrix Fm.

The example here uses the built-in sample matrix Sm. 

```{r message=FALSE}
Results <- simulated_annealing(Sm)
```

```{r results}
Results$`condition number`
Results$RMSE
Results$MAE
Results$Error

Results$`F matrix`
Results$`Class abundances`
```

```{r figure-results, fig.width=8}
Results$Figure
```


