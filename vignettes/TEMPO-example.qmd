---
title: "Example Usage : TEMPO"
output:
   rmarkdown::html_vignette:
     tabset: true
bibliography: references.bib
vignette: >
  %\VignetteIndexEntry{The phytoclass package}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---


```{r setup}
library(phytoclass)
```

```{R}
# sample matrix
S_matrix <- read.csv("vignettes/TEMPO-example-S-matrix.csv")
```

```{R}
# pigment-taxa occurrence matrix (specific to an oceanographic region)
F_matrix <- read.csv("vignettes/TEMPO-example-F-matrix.csv")
```

```{R}
#| code-summary: clean up the F matrix
# === remove numeric rownames introduced by read.csv
if (all(grepl("^[0-9]+$", rownames(F_matrix)))) {
  print("dropping unneeded numeric index")
  # Set the first column as row names
  rownames(F_matrix) <- F_matrix[[1]]
  
  # Remove the first column
  F_matrix <- F_matrix[, -1] 
}
```

```{R}
# min-max matrix for bounding pigment-taxa fits (taxa specific)
min_max_matrix <- phytoclass::min_max
```

```{R}
#| code-summary: find mismatches between F and S
# Assume taxa and S_matrix are the two matrices
headers1 <- colnames(F_matrix)
headers2 <- colnames(S_matrix)

# Find headers in taxa that are not in S_matrix
only_in_mtx1 <- setdiff(headers1, headers2)

# Find headers in S_matrix that are not in taxa
only_in_mtx2 <- setdiff(headers2, headers1)

# Find headers common to both matrices
common_headers <- intersect(headers1, headers2)

if (! length(common_headers) > 0){
  cat(
    "Headers only in F Matrix:\n", 
    paste(only_in_mtx1, collapse = ", "), 
    "\n"
  )
  cat(
    "Headers only in selectedCluster:\n", 
    paste(only_in_mtx2, collapse = ", "), 
    "\n"
  )
  cat(
    "Headers common to both matrices:\n", 
    paste(common_headers, collapse = ", "), 
    "\n"
  )
  stop("ERR: S and F matrix have different columns.")
}
```

```{R}
phytoclass::simulated_annealing(
  S_matrix,
  Fmat = F_matrix
  # user_defined_min_max = min_max_matrix
)
```